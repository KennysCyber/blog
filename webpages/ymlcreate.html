<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';">
    <title>Ansible YAML Inventory Builder - 18gi0n's Tech Lair</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="icon" type="image/x-icon" href="/assets/images/racoon.ico">
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        body {
            position: relative;
            min-height: 100vh;
        }

        .opaque-bg {
            background-color: rgba(13, 13, 13, 0.6);
            position: fixed;
            top: 50px;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .content {
            position: relative;
            z-index: 2;
            min-height: 100vh;
            padding-bottom: 20px;
        }

        .content .left-aligned-content {
            text-align: left !important;
            max-width: 800px;
            margin: 0 20px !important;
            padding: 20px 0 !important;
        }

        .content .left-aligned-content h1,
        .content .left-aligned-content h2,
        .content .left-aligned-content p,
        .content .left-aligned-content ul,
        .content .left-aligned-content ol,
        .content .left-aligned-content li {
            text-align: left !important;
        }

        .content .left-aligned-content a {
            color: #ff9933 !important;
            text-decoration: underline;
        }

        .content .left-aligned-content a:hover {
            color: #ff007a !important;
            text-shadow: 0 0 5px #ff007a;
        }

        .content .left-aligned-content pre {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
            position: relative;
        }

        .content .left-aligned-content code {
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 14px;
        }

        .content .left-aligned-content .copy-btn {
            display: none;
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff9933;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Consolas', 'Courier New', monospace;
        }

        .content .left-aligned-content pre:hover .copy-btn {
            display: block;
        }

        .content .left-aligned-content .copy-btn:hover {
            background: #ff007a;
        }

        .content .left-aligned-content .copy-btn:focus {
            outline: 2px solid #ff007a;
            outline-offset: 2px;
        }

        @media (max-width: 600px) {
            .content .left-aligned-content {
                margin: 0 10px !important;
            }
        }
    </style>
</head>

<body>
    <!-- Nav Bar -->
    <nav>
        <ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/about.html">About</a></li>
            <li><a href="/projects.html">Projects</a></li>
            <li><a href="/code.html">Code & Tools</a></li>
            <li><a href="/ctf.html">Write-ups</a></li>
            <li><a href="/research.html">Research</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="opaque-bg" id="opaqueBg"></div>
    <div class="content">
        <div class="left-aligned-content">
            <h1>Ansible YAML Inventory Builder</h1>
            <img src="/assets/images/Code/ansibleHS/ymlcreate/thumbnail (1).png"
                alt="Ansible YAML Inventory Builder cover" width="600" height="400">

            <h2>Project Overview</h2>
            <p>
                This interactive Python script simplifies creating valid Ansible YAML inventories, especially in
                airgapped environments. It guides you through defining groups, hosts (supporting formats like
                <code>hostname=ip</code>, hostname-only, or IP-only), and optional child groups. The output is clean,
                Ansible-compliant YAML ready for immediate use with <code>ansible</code> or
                <code>ansible-playbook</code> commands.
            </p>
            <p>
                Built quickly with GenAI assistance—perfect for labs, automation pipelines, or teaching Ansible basics.
                It eliminates manual YAML errors and enforces best practices.
            </p>
            <ul>
                <li><strong>Requirements:</strong> Python 3 with PyYAML (install via <code>pip install pyyaml</code> if
                    needed).</li>
                <li><strong>Usage:</strong> Run <code>python3 yml-create.py</code> (or with
                    <code>--output filename.yml</code> to skip prompt).
                </li>
                <li><strong>Features:</strong> Input validation, child group checks, sorted output, and built-in
                    preview.</li>
            </ul>

            <h2>Full Code</h2>
            <p><strong>Security Note:</strong> Always review code before executing. SHA256 Hash:
                51ea38c9041b22416e305b7abeb27ccf8d0ebc13c2d71b424a6cc7dd6c039a30/p>
            <pre><code id="fullCode">
import argparse
import sys
import yaml

def main():
    parser = argparse.ArgumentParser(
        description="Interactively build an Ansible YAML inventory (official format)."
    )
    parser.add_argument(
        "--output",
        default=None,
        help="Output file for the inventory (skips filename prompt)"
    )
    args = parser.parse_args()

    # Internal structure:
    # groupname: {
    #   'hosts': {hostname: {vars}},
    #   'children': set()
    # }
    groups = {}

    print("\nInteractive Ansible YAML Inventory Builder")
    print("Rules:")
    print("- Top-level keys are group names")
    print("- Hosts may be 'hostname=ip', hostname-only, or ip-only")
    print("- Child groups are optional\n")

    while True:
        group_name = input("Enter group name (or 'done' to finish): ").strip()
        if group_name.lower() == "done":
            break
        if not group_name:
            print("Group name cannot be empty.\n")
            continue

        group = groups.setdefault(
            group_name,
            {"hosts": {}, "children": set()}
        )

        hosts_input = input(
            f"Hosts for '{group_name}' "
            "(comma-separated, empty for none): "
        ).strip()

        if hosts_input:
            for item in hosts_input.split(","):
                item = item.strip()
                if not item:
                    continue

                # hostname=ip format
                if "=" in item:
                    hostname, addr = item.split("=", 1)
                    hostname = hostname.strip()
                    addr = addr.strip()

                    if not hostname or not addr:
                        print(f"Ignoring invalid host entry: {item}")
                        continue

                    group["hosts"][hostname] = {
                        "ansible_host": addr
                    }
                else:
                    # hostname-only OR ip-only
                    group["hosts"][item] = {}

        children_input = input(
            f"Child groups for '{group_name}' "
            "(comma-separated, empty for none): "
        ).strip()

        if children_input:
            for child in children_input.split(","):
                child = child.strip()
                if not child:
                    continue
                if child == group_name:
                    print("A group cannot be its own child — ignored.")
                else:
                    group["children"].add(child)

        print()

    if not groups:
        print("No groups defined. Exiting.")
        sys.exit(0)

    # Validate referenced children
    defined_groups = set(groups.keys())
    undefined_children = {
        child
        for g in groups.values()
        for child in g["children"]
        if child not in defined_groups
    }

    if undefined_children:
        print("\nWarning: These child groups are referenced but not defined:")
        for name in sorted(undefined_children):
            print(f"  - {name}")
        if input("Proceed anyway? (y/n): ").strip().lower() != "y":
            print("Aborted.")
            sys.exit(1)

    # Build final inventory
    inventory = {}

    for group_name in sorted(groups):
        data = groups[group_name]
        entry = {}

        # Hosts (always emitted)
        entry["hosts"] = dict(sorted(data["hosts"].items()))

        # Children (only if defined)
        if data["children"]:
            entry["children"] = {child: {} for child in sorted(data["children"])}

        inventory[group_name] = entry

    # Output filename
    if args.output:
        output_file = args.output
    else:
        while True:
            output_file = input("Output filename (inventory.yml): ").strip()
            if output_file:
                break

    # Write YAML
    try:
        with open(output_file, "w") as f:
            yaml.safe_dump(
                inventory,
                f,
                indent=2,
                sort_keys=False,
                default_flow_style=False
            )
    except Exception as e:
        print(f"Error writing file: {e}")
        sys.exit(1)

    print(f"\nInventory written to {output_file}\n")

    print("Preview:")
    print("-" * 40)
    with open(output_file) as f:
        print(f.read())

if __name__ == "__main__":
    main()
            </code></pre>

            <h2>Execution Demo</h2>
            <p>Running the script and generating an inventory:</p>
            <img src="/assets/images/Code/ansibleHS/ymlcreate/1.png" alt="Script execution in terminal" width="600"
                height="500">

            <p>Verifying the generated inventory with Ansible:</p>
            <img src="/assets/images/Code/ansibleHS/ymlcreate/2.png" alt="ansible-inventory --list output" width="600"
                height="500">

            <h2>Conclusion</h2>
            <p>
                This lightweight tool makes Ansible inventory creation fast, error-free, and repeatable—ideal for
                airgapped setups or quick prototyping. Save as <code>yml-create.py</code>, make executable if desired,
                and start building inventories effortlessly.
            </p>
        </div>
    </div>
</body>

</html>